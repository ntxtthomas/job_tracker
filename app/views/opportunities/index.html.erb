<p style="color: green"><%= notice %></p>

<% content_for :title, "Opportunities" %>

<div style="margin-bottom: 1.5rem;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h1 style="margin: 0;">Opportunities</h1>
      <% if @date_filter %>
        <p style="margin: 0.5rem 0 0 0; color: var(--text-muted); font-size: 0.95rem;">
          Showing applications from <%= @date_filter %>
          <%= link_to "Clear filter", opportunities_path, style: "margin-left: 1rem; color: #0d6efd; text-decoration: none;" %>
        </p>
      <% end %>
    </div>
  <div style="display: flex; gap: 0.5rem;">
    <%= link_to "New opportunity", new_opportunity_path, style: "margin-top: 20px; background-color: #0d6efd; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s ease; text-decoration: none; display: inline-block;", onmouseover: "this.style.backgroundColor='#0b5ed7'", onmouseout: "this.style.backgroundColor='#0d6efd'", onmousedown: "this.style.transform='scale(0.95)'", onmouseup: "this.style.transform='scale(1)'" %>
    <%= link_to "Download CSV", opportunities_path(format: :csv, start_date: params[:start_date], end_date: params[:end_date]), style: "margin-top: 20px; text-decoration: none; padding: 10px 20px; background-color: #6c757d; color: white; border-radius: 4px; display: inline-block; cursor: pointer; transition: all 0.2s ease;", onmouseover: "this.style.backgroundColor='#5a6268'", onmouseout: "this.style.backgroundColor='#6c757d'", onmousedown: "this.style.transform='scale(0.95)'", onmouseup: "this.style.transform='scale(1)'" %>
  </div>
</div>

  <!-- Role Type Filter -->
  <div style="margin-bottom: 1rem; padding: 1rem; background-color: var(--bg-secondary, #f8f9fa); border-radius: 5px;">
    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
      <label for="role_type_filter" style="font-weight: 600; margin: 0; color: var(--text-primary, #333);">Filter by Role Type:</label>
      <%= form_with url: opportunities_path, method: :get, local: true do |f| %>
        <%= f.select :role_type,
            options_for_select(Opportunity::ROLE_TYPES.map { |k, v| [v, k] }, params[:role_type]),
            { include_blank: "All Roles" },
            id: "role_type_filter",
            style: "padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-width: 200px;" %>
        <%= f.submit "Filter", style: "padding: 8px 16px; background-color: #6f42c1; color: white; border: none; border-radius: 4px; cursor: pointer;" %>
        <% if params[:role_type].present? %>
          <%= link_to "Clear", opportunities_path, style: "padding: 8px 16px; background-color: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block;" %>
        <% end %>
      <% end %>
    </div>
  </div>

<div id="opportunities">
  <table>
    <thead>
      <tr>
        <th><%= sortable_link :role_type, "Role Type" %></th>
        <th><%= sortable_link :company %></th>
        <th><%= sortable_link :position_title, "Position" %></th>
        <th><%= sortable_link :application_date, "Application Date" %></th>
        <th><%= sortable_link :status %></th>
        <th><%= sortable_link :source %></th>
        <th><%= sortable_link :tech_stack, "Tech Stack" %></th>
        <th><%= sortable_link :salary_range, "Salary Range" %></th>
        <th><%= sortable_link :chatgpt_match, "ChatGPT" %></th>
        <th><%= sortable_link :jobright_match, "Jobright" %></th>
        <th><%= sortable_link :linkedin_match, "LinkedIn" %></th>
      </tr>
    </thead>
    <tbody>
      <% @opportunities.each do |opportunity| %>
      <%= render opportunity %>
      <% end %>
    </tbody>
  </table>
</div>
