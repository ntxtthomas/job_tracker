<p style="color: green"><%= notice %></p>

<% content_for :title, "Opportunities" %>

<div style="margin-bottom: 1.5rem;">
  <!-- Role Type Filter -->
  <div style="margin-bottom: 1rem; padding: 1rem; background-color: var(--bg-secondary, #f8f9fa); border-radius: 5px;">
    <label style="font-weight: 600; margin-right: 1rem; color: var(--text-primary, #333);">Filter by Role Type:</label>
    <div style="display: inline-flex; gap: 0.5rem; flex-wrap: wrap;">
      <%= link_to "All", opportunities_path(role_type: "all"), 
          style: "padding: 6px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.2s; width: 160px; text-align: center;
                  #{ params[:role_type].blank? || params[:role_type] == 'all' ? 'background-color: #0d6efd; color: white;' : 'background-color: white; color: #333; border: 1px solid #dee2e6;' }",
          onmouseover: "if (!this.style.backgroundColor.includes('rgb(13, 110, 253)')) { this.style.backgroundColor='#e9ecef'; }",
          onmouseout: "if (!this.style.backgroundColor.includes('rgb(13, 110, 253)')) { this.style.backgroundColor='white'; }" %>
      
      <%= link_to "Software Engineer", opportunities_path(role_type: "software_engineer"), 
          style: "padding: 6px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.2s; width: 160px; text-align: center;
                  #{ params[:role_type] == 'software_engineer' ? 'background-color: #6c757d; color: white;' : 'background-color: white; color: #333; border: 1px solid #dee2e6;' }",
          onmouseover: "if (!this.style.backgroundColor.includes('rgb(108, 117, 125)')) { this.style.backgroundColor='#e9ecef'; }",
          onmouseout: "if (!this.style.backgroundColor.includes('rgb(108, 117, 125)')) { this.style.backgroundColor='white'; }" %>
      
      <%= link_to "Sales Engineer", opportunities_path(role_type: "sales_engineer"), 
          style: "padding: 6px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.2s; width: 160px; text-align: center;
                  #{ params[:role_type] == 'sales_engineer' ? 'background-color: #28a745; color: white;' : 'background-color: white; color: #333; border: 1px solid #dee2e6;' }",
          onmouseover: "if (!this.style.backgroundColor.includes('rgb(40, 167, 69)')) { this.style.backgroundColor='#e9ecef'; }",
          onmouseout: "if (!this.style.backgroundColor.includes('rgb(40, 167, 69)')) { this.style.backgroundColor='white'; }" %>
      
      <%= link_to "Solutions Engineer", opportunities_path(role_type: "solutions_engineer"), 
          style: "padding: 6px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.2s; width: 160px; text-align: center;
                  #{ params[:role_type] == 'solutions_engineer' ? 'background-color: #17a2b8; color: white;' : 'background-color: white; color: #333; border: 1px solid #dee2e6;' }",
          onmouseover: "if (!this.style.backgroundColor.includes('rgb(23, 162, 184)')) { this.style.backgroundColor='#e9ecef'; }",
          onmouseout: "if (!this.style.backgroundColor.includes('rgb(23, 162, 184)')) { this.style.backgroundColor='white'; }" %>
      
      <%= link_to "Product Manager", opportunities_path(role_type: "product_manager"), 
          style: "padding: 6px 16px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: all 0.2s; width: 160px; text-align: center;
                  #{ params[:role_type] == 'product_manager' ? 'background-color: #6f42c1; color: white;' : 'background-color: white; color: #333; border: 1px solid #dee2e6;' }",
          onmouseover: "if (!this.style.backgroundColor.includes('rgb(111, 66, 193)')) { this.style.backgroundColor='#e9ecef'; }",
          onmouseout: "if (!this.style.backgroundColor.includes('rgb(111, 66, 193)')) { this.style.backgroundColor='white'; }" %>
    </div>
    <% if @role_filter %>
      <span style="margin-left: 1rem; color: var(--text-muted); font-size: 0.9rem;">
        Showing: <strong><%= @role_filter %></strong>
        <%= link_to "Clear", opportunities_path, style: "margin-left: 0.5rem; color: #0d6efd; text-decoration: none; font-size: 0.9rem;" %>
      </span>
    <% end %>
  </div>

  <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h1 style="margin: 0;">Opportunities</h1>
      <% if @date_filter %>
        <p style="margin: 0.5rem 0 0 0; color: var(--text-muted); font-size: 0.95rem;">
          Showing applications from <%= @date_filter %>
          <%= link_to "Clear filter", opportunities_path, style: "margin-left: 1rem; color: #0d6efd; text-decoration: none;" %>
        </p>
      <% end %>
    </div>
  <div style="display: flex; gap: 0.5rem;">
    <%= link_to "New opportunity", new_opportunity_path, style: "margin-top: 20px; background-color: #0d6efd; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s ease; text-decoration: none; display: inline-block;", onmouseover: "this.style.backgroundColor='#0b5ed7'", onmouseout: "this.style.backgroundColor='#0d6efd'", onmousedown: "this.style.transform='scale(0.95)'", onmouseup: "this.style.transform='scale(1)'" %>
    <%= link_to "Download CSV", opportunities_path(format: :csv, start_date: params[:start_date], end_date: params[:end_date]), style: "margin-top: 20px; text-decoration: none; padding: 10px 20px; background-color: #6c757d; color: white; border-radius: 4px; display: inline-block; cursor: pointer; transition: all 0.2s ease;", onmouseover: "this.style.backgroundColor='#5a6268'", onmouseout: "this.style.backgroundColor='#6c757d'", onmousedown: "this.style.transform='scale(0.95)'", onmouseup: "this.style.transform='scale(1)'" %>
  </div>
</div>

<div id="opportunities">
  <table>
    <thead>
      <tr>
        <th><%= sortable_link :role_type, "Role Type" %></th>
        <th><%= sortable_link :company %></th>
        <th><%= sortable_link :position_title, "Position" %></th>
        <th><%= sortable_link :application_date, "Application Date" %></th>
        <th><%= sortable_link :status %></th>
        <th><%= sortable_link :source %></th>
        <th><%= sortable_link :tech_stack, "Tech Stack" %></th>
        <th><%= sortable_link :salary_range, "Salary Range" %></th>
        <th><%= sortable_link :chatgpt_match, "ChatGPT" %></th>
        <th><%= sortable_link :jobright_match, "Jobright" %></th>
        <th><%= sortable_link :linkedin_match, "LinkedIn" %></th>
      </tr>
    </thead>
    <tbody>
      <% @opportunities.each do |opportunity| %>
      <%= render opportunity %>
      <% end %>
    </tbody>
  </table>
</div>
