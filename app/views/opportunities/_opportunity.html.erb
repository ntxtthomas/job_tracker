<tr id="<%= dom_id opportunity %>" class="clickable-row" data-href="<%= opportunity_path(opportunity) %>">
  <td>
    <%
      badge_color = case opportunity.role_type
      when "software_engineer"
        "#6c757d" # Gray
      when "sales_engineer"
        "#28a745" # Green
      when "solutions_engineer"
        "#17a2b8" # Teal
      when "product_manager"
        "#6f42c1" # Purple
      else
        "#6c757d" # Default gray
      end
    %>
    <span style="
      background-color: <%= badge_color %>;
      color: white;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      display: inline-block;
      width: 80px;
      text-align: center;
    ">
      <%= opportunity.role_type_label.gsub("Engineer", "Eng").gsub("Manager", "Mgr") %>
    </span>
  </td>
  <td><%= opportunity.company.name if opportunity.company %></td>
  <td><%= opportunity.position_title %></td>
  <td><%= opportunity.application_date %></td>
  <td><%= opportunity.status.present? && opportunity.status != "select" ? opportunity.status : "" %></td>
  <td><%= opportunity.source.present? ? opportunity.source.humanize : "" %></td>
  <td>
    <% tech_sources = opportunity.technologies.map { |t| { name: t.name, category: t.category, source: :opportunity } } %>
    <% if opportunity.other_tech_stack.present? %>
      <% tech_sources << { name: opportunity.other_tech_stack.truncate(20), category: "Other", source: :other } %>
    <% end %>
    
    <% if tech_sources.any? %>
      <div style="display: flex; flex-wrap: wrap; gap: 4px; align-items: center;">
        <% 
          main_categories = ["Backend", "Frontend"]
          main_techs = tech_sources.select { |t| main_categories.include?(t[:category]) }
          other_techs = tech_sources.reject { |t| main_categories.include?(t[:category]) }
          
          # If no main techs, use other techs
          display_techs = main_techs.any? ? main_techs : other_techs
        %>
        <% display_techs.first(2).each do |tech| %>
          <span style="
            background-color: #e7f1ff;
            color: #0056b3;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            border: 1px solid #b8daff;
            white-space: nowrap;
          ">
            <%= tech[:name] %>
          </span>
        <% end %>
        <% if display_techs.count > 2 %>
          <span style="
            font-weight: bold;
            color: var(--text-secondary, #666);
            padding: 2px 4px;
            font-size: 12px;
            cursor: pointer;
          ">+</span>
        <% end %>
      </div>
    <% else %>
      <span style="color: #999;">N/A</span>
    <% end %>
  </td>
  <td><%= opportunity.salary_range %></td>
  <td><%= opportunity.chatgpt_match %></td>
  <td><%= opportunity.jobright_match %></td>
  <td><%= opportunity.linkedin_match %></td>
</tr>
