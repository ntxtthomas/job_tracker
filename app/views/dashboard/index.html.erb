<% content_for :title, "Dashboard" %>

<h1>Job Tracker Dashboard</h1>

<div class="dashboard-cards">
  <div class="card card-submitted">
    <div class="card-header">
      <h3>Applications Submitted</h3>
      <div class="card-icon">ğŸ“‹</div>
    </div>
    <div class="card-body">
      <div class="card-number"><%= @total_resumes %></div>
      <p class="card-subtitle">Total applications sent</p>
    </div>
  </div>
</div>

<h2 style="margin-top: 3rem; margin-bottom: 1rem; color: var(--text-secondary);">Applications by Week</h2>
<div class="dashboard-cards weekly-cards">
  <% @weekly_data.each_with_index do |week, index| %>
    <%= link_to opportunities_path(start_date: week[:start_date], end_date: week[:end_date]), class: "card card-week clickable-week-card", style: "text-decoration: none; color: inherit;" do %>
      <div class="card-header">
        <h3><%= week[:label] %></h3>
        <div class="card-icon">ğŸ“…</div>
      </div>
      <div class="card-body">
        <div class="card-number"><%= week[:count] %></div>
        <p class="card-subtitle">applications</p>
      </div>
    <% end %>
  <% end %>
</div>

<div style="display: flex; gap: 2rem; flex-wrap: wrap; margin-top: 2rem;">
  <% if @tech_stack_data.any? %>
    <div class="dashboard-cards" style="max-width: 800px; flex: 1; min-width: 400px;">
      <div class="card">
        <div class="card-header">
          <h3>Tech Stack Distribution</h3>
          <div class="card-icon">ğŸ“Š</div>
        </div>
        <div class="card-body">
          <div class="tech-stack-chart">
            <% max_count = @tech_stack_data.values.max %>
            <% @tech_stack_data.each do |tech_stack, count| %>
              <div class="chart-bar-container">
                <div class="chart-label"><%= tech_stack %></div>
                <div class="chart-bar-wrapper">
                  <div class="chart-bar" style="width: <%= (count.to_f / max_count * 100).round(1) %>%;">
                    <span class="chart-count"><%= count %></span>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if @source_data.any? %>
    <div class="dashboard-cards" style="max-width: 800px; flex: 1; min-width: 400px;">
      <div class="card">
        <div class="card-header">
          <h3>Source Distribution</h3>
          <div class="card-icon">ğŸ”</div>
        </div>
        <div class="card-body">
          <div class="tech-stack-chart">
            <% max_count_source = @source_data.values.max %>
            <% @source_data.each do |source, count| %>
              <div class="chart-bar-container">
                <div class="chart-label"><%= source&.humanize %></div>
                <div class="chart-bar-wrapper">
                  <div class="chart-bar" style="width: <%= (count.to_f / max_count_source * 100).round(1) %>%;">
                    <span class="chart-count"><%= count %></span>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>
